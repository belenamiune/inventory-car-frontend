<div class="px-4 sm:px-6 md:px-10 py-6">
<!-- Filtros + Botón  -->
<div class="grid gap-3 md:flex md:justify-between md:items-end mb-4 animate-fade-in">
  <!-- Grupo de Filtros -->
  <div class="grid gap-3 grid-cols-1 sm:grid-cols-2 md:flex md:flex-row md:gap-3 w-full">
    <!-- Buscar por nombre -->
    <span class="p-input-icon-left w-full md:w-60">
      <i class="pi pi-search"></i>
      <input
        type="text"
        pInputText
        [(ngModel)]="nombre"
        placeholder="Buscar por nombre"
        class="w-full"
      />
    </span>

    <!-- Dropdown categoría -->
    <p-dropdown
      [options]="(categorias$ | async ) || []"
      optionLabel="nombre"
      optionValue="_id"
      [(ngModel)]="categoria"
      placeholder="Categoría"
      [showClear]="true"
    ></p-dropdown>

    <!-- Botón Buscar -->
    <button
      pButton
      type="button"
      icon="pi pi-filter"
      label="Buscar"
      class="p-button-outlined w-full md:w-auto"
      (click)="onBuscar()"
    ></button>

    <button
  pButton
  type="button"
  icon="pi pi-times"
  label="Limpiar"
  class="p-button-outlined p-button-secondary w-full md:w-auto"
  (click)="resetFiltros()"
></button>
  </div>

  <!-- Botón Nuevo -->
  <div class="w-full md:w-auto">
    <button
      pButton
      icon="pi pi-plus"
      label="Nuevo"
      class="p-button-primary w-full md:w-auto"
      (click)="abrirNuevo()"
    ></button>

  </div>
</div>

<!-- Tabla de productos -->
 <div class="mt-4">
  <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-200 mb-3 mt-5">Listado de Productos</h2>
  
  <p-table
    class="animate-fade-in min-w-full mt-4 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden"
    [value]="(productos$ | async) || []"
    [paginator]="true"
    [rows]="rows"
    [totalRecords]="(total$ | async) || 0"
    [lazy]="true"
    (onLazyLoad)="onPageChange($event)"
    [loading]="(loading$ | async) || false"
    responsiveLayout="scroll"
    scrollHeight="flex"
  >
    <ng-template pTemplate="header">
      <tr class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200">
        <th>Imagen</th>
        <th>Nombre</th>
        <th>Categoría</th>
        <th>Precio</th>
        <th>Stock</th>
        <th class="text-center">Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-producto>
      <tr class="border-b border-gray-200 dark:border-gray-700">
        <td>
          <img
            [src]="producto.imagenUrl || 'https://placehold.co/150x150?text=Sin+Imagen'"
            alt="img"
            width="50"
            class="rounded-full shadow-sm object-cover border border-gray-200 dark:border-gray-700"
          />
        </td>

        <td
          class="text-indigo-600 dark:text-indigo-400 underline cursor-pointer"
          (click)="verDetalle(producto)"
        >
          {{ producto.nombre }}
        </td>

        <td>
        <span *ngIf="producto.categorias?.length; else sinCategoria">
            {{ producto.categorias[0]?.nombre }}
        </span>
        <ng-template #sinCategoria>---</ng-template>
        </td>

        <td>$ {{ producto.precio }}</td>

        <td>
          {{ producto.stock }}
          <span
            *ngIf="producto.stock < 5"
            class="p-tag p-tag-rounded p-tag-danger ml-2 text-xs"
            >Bajo</span
          >
        </td>

        <td class="text-center">
          <button
            pButton
            icon="pi pi-pencil"
            class="p-button-sm p-button-text text-primary"
            (click)="abrirEdicion(producto)"
          ></button>

          <button
            pButton
            icon="pi pi-trash"
            class="p-button-sm p-button-text text-red-500"
            (click)="confirmarEliminar(producto)"
          ></button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Modal para crear/editar -->
<app-producto-form
  [visible]="modalVisible"
  [categorias]="(categorias$ | async) || []"
  [producto]="productoSeleccionado"
  (cerrar)="cerrarModal()"
  (guardar)="guardarProducto($event)">
</app-producto-form>
<p-confirmDialog></p-confirmDialog>
</div>